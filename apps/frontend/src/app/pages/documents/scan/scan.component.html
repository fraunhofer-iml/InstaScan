<!--
  ~ Copyright Fraunhofer Institute for Material Flow and Logistics
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License").
  ~ For details on the licensing terms, see the LICENSE file.
  ~ SPDX-License-Identifier: Apache-2.0
  -->

<div class="container-camera card">
    <ng-container *ngIf="isCameraConnected | async; else noCamera">
        <img id="video"
             [src]="liveImage | async"
             alt="camera"
             *ngIf="liveImage; else loading"
        />
    </ng-container>
    <div class="grid-item bundle">
        <h2 class="bundle-title">Bundle</h2>
        <mat-form-field class="input-bundle">
            <mat-label>Bundle ID</mat-label>
            <input matInput [formControl]="bundleId" />
        </mat-form-field>
        <mat-divider class="divider"/>
        <div class="document-header">
            <h2 class="document-title">Documents</h2>
            <span class="document-count">{{ encodedImageFiles.length || 0 }}</span>
        </div>
        <div *ngIf="encodedImageFiles" class="encodedImageFiles">
            <div *ngFor="let encodedImageFile of encodedImageFiles; let index = index" class="encodedImageFile">
              <img [src]="encodedImageFile"
                   (click)="openImagePreview(encodedImageFile)"
                   alt="Scanned document"
                   onKeyUp=""
                   class="image" />
              <mat-icon (click)="removeImage(index)" class="delete-icon icon" fontSet="material-symbols-outlined" onKeyUp="">delete</mat-icon>
              <mat-form-field class="dropdown-document-type" appearance="outline">
                <mat-label>Document type</mat-label>
                <mat-select [(ngModel)]="documentTypeSelections[index]">
                  <mat-option *ngFor="let option of documentTypes" [value]="option">
                    {{ option }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
        </div>
      <button mat-flat-button
              class="confirm-button"
              [disabled]="isAnalyseDisabled"
              (click)="confirmBundle(bundleId.value, documentTypeSelections)"
      >Analyse</button>
    </div>
    <div class="bundle-controls">
        <div class="button-document" onKeyUp="" (click)="captureImage()" [class.disabled]="!(isCameraConnected | async)" >
            <mat-icon class="icon-buttons" fontSet="material-symbols-outlined">camera</mat-icon>
        </div>
        <div class="button-document" onKeyUp="" (click)="openUploadDocument()">
            <mat-icon class="icon-buttons" fontSet="material-symbols-outlined">cloud_upload</mat-icon>
        </div>
    </div>
</div>

<ng-template #loading>
    <p class="loading-text">Loading camera feed...</p>
</ng-template>
<ng-template #noCamera>
    <div class="camera-error-message">
        <p>Camera not detected</p>
    </div>
</ng-template>