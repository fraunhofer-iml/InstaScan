[[chapter-building-block-view]]
:docinfo: shared
:toc: left
:toclevels: 3
:sectnums:
:copyright: Apache License 2.0

= Building Block View

The building block view is a static and hierarchical decomposition of the system into building blocks and their relationships.
It is a collection descriptions for all important components.
Building blocks may be modules, components, subsystems, classes, interfaces, packages, libraries, frameworks, layers, partitions, tiers, functions, macros, operations, data structures, etc.).


== Overview

The project essentially consists of a front-end and several back-end components.
The frontend is a web interface for the user and was developed using Angular.
The backend consists of an backend for frontend, which is responsible for routing requests from the frontend to the corresponding service, and a number of services, which provide the business logic.
The storage-service is a nestjs application and the document-analyzation-service is a python application.
Additionally, the backend utilizes a database and an object storage system for data storage.


== Building Blocks - Level 1

In level 1, the components of {projectName} are shown.

[cols="1,1,3",options="header"]
|===
| Name
| Status
| Responsibility / Description

| Frontend
| Custom development
| The frontend is the user interface of the project. All actions such as batch creation are carried out from here and all saved data can be viewed. It allows to upload new documents to be saved and analyzed.

| Backend for frontend
| Custom development
| The service that receives the interface calls from the frontend and forwards them to the other services.

| Storage service
| Custom development
| The storage service is responsible for storing the image data sent by the BFF in the document storage. At the same time, an entry containing the uuid of the document should be created in the database for each upload.

| Document analyzation service
| Custom development
| The document analysis service has the task of processing the image files sent by the BFF, checking which document it is and sending the image to an AI service via a prompt and the appropriate data schema. The result is then sent back to the storage service.

| Message-broker
| Message-broker software
| The service that connects all services from the API service onwards.

| Postgres database
| Relational database management system
| All information is stored non-temporarily here.

| S3 File Storage
| Object storage system
| Saves the scanned documents.
|===


== Building Blocks - Level 2

In Level 2, the internal components of the above are shown.

[options="header"]
|===
|Name |Status |Responsibility / Description

|frontend
|Frontend a|
The frontend of InstaScan is an Angular-based Progressive Web App (PWA).
It has been developed following the best practices recommended by the Angular community.

*Components:*
* The component design pattern follows a separation between smart and dumb components. 
Smart components are primarily used at the page level and handle data and logic, while
dumb components focus solely on presentation and receive their inputs from smart components.

*Services:*

* The services are responsible for managing the business logic and for communitcating with backend services.

*API:*
* API Documentation can be found
----
TBD
----

|backend for frontend(bff)
| Backend For Frontend (BFF) a|
The Backend for Frontend (BFF) serves as the dedicated interface layer between the Angular-based frontend and the internal microservices.  
It ensures a clear separation of concerns and shields the client from the complexity of the distributed backend landscape.

*Responsibilities:*

* Receives all HTTP requests from the frontend and routes them to the respective microservices.
* Performs request aggregation to reduce the number of calls the frontend must execute.
* Transforms and normalizes data structures to provide a frontend-optimized API surface.
* Implements authentication and authorization checks where required.
* Ensures protocol translation between the frontend (HTTP/REST) and backend services (HTTP, AMQP).

*Internal Components:*

* **Controller Layer** – Exposes REST endpoints consumed by the frontend.
* **Service Layer** – Bridges communication with storage-service and analysis-service.
* **Message-Broker Adapter** – Publishes and consumes events such as image updates.

---

|storage service
| Storage Service a|
The storage service is a central backend component responsible for persisting, managing, and distributing all document-related data.  
It forms the core of the system’s data lifecycle and coordinates between the database, the S3 file storage, and the analyzation service.

*Responsibilities:*

* Stores uploaded document images in S3 object storage.
* Creates and updates database records containing metadata, UUIDs, analysis status, and document classification.
* Exposes endpoints and message patterns for retrieving and modifying image data.
* Provides interfaces for document bundles, document metadata, and NFT/token information.
* Handles events from the analyzation service and updates stored data accordingly.
* Publishes events to notify the frontend (via BFF) about data updates (e.g., refreshed analysis results).

*Internal Components:*

* **Image Controller** – Handles inbound REST and AMQP requests for managing document data.
* **Image Service** – Contains the business logic for storing, updating, and retrieving image information.
* **Database Adapter** – Persists metadata in PostgreSQL.
* **S3 Storage Adapter** – Uploads, downloads, and deletes image files.
* **Message-Broker Integration** – Publishes refresh events and processes analysis results.


|document analyzation service| Document Analyzation Service a|
TBD

|===